import os\nfrom composio.client.collections import TriggerEventData\nfrom composio_llamaindex import Action, App, ComposioToolSet\nfrom llama_index.core.agent import FunctionCallingAgentWorker\nfrom llama_index.core.llms import ChatMessage\nfrom llama_index.llms.groq import Groq\nfrom llama_index.llms.openai import OpenAI\n\ncomposio_toolset = ComposioToolSet()\ntools = composio_toolset.get_actions(\n    actions=[\n        Action.GITHUB_GET_CODE_CHANGES_IN_PR,\n        Action.GITHUB_PULLS_CREATE_REVIEW_COMMENT,\n        Action.GITHUB_ISSUES_CREATE,\n        Action.SLACKBOT_CHAT_POST_MESSAGE,\n    ]\n)\nllm = OpenAI(\"GPT-4o\")\nprefix_messages = [\n    ChatMessage(\n        role=\"system\",\n        content=(\"\"\"\n            You are an experienced code reviewer.\n            Your task is to review the provided file diff and give constructive feedback.\n            Follow these steps:\n            1. Identify if the file contains significant logic changes.\n            2. Summarize the changes in the diff in clear and concise English, within 100 words.\n            3. Provide actionable suggestions if there are any issues in the code.\n            Once you have decided on the changes, for any TODOs, create a Github issue.\n            Also add the comprehensive review to the PR as a comment.\n        \"\"\"\n        ),\n    )\n]\nagent = FunctionCallingAgentWorker(\n    tools=tools,\n    llm=llm,\n    prefix_messages=prefix_messages,\n    max_function_calls=10,\n    allow_parallel_tool_calls=False,\n    verbose=True\n).as_agent()\npr_agent_tools = composio_toolset.get_actions(\n    actions=[\n        Action.GITHUB_GET_CODE_CHANGES_IN_PR,\n        Action.GITHUB_PULLS_CREATE_REVIEW_COMMENT,\n        Action.GITHUB_ISSUES_CREATE,\n        Action.SLACKBOT_CHAT_POST_MESSAGE,\n    ]\n)\nlistener = composio_toolset.create_trigger_listener()\n@listener.callback(filters={\"trigger_name\":\"github_pull_request_event\"})\ndef review_new_pr(event: TriggerEventData) -> None\n    code_to_review = str(event.payload)\n    response = agent.chat(\"Review the following pr:\"+code_to_review)\n    print(response)\nprint(\"Listener started!\")\nprint(\"Create a pr to get the review\")\nlistener.listen()listener.listen()